Para practicar el concepto impartido en la clase, el alumno debe seguir los siguientes pasos:

Introducción y contextualización (25%): El estudiante debe familiarizarse con el ejemplo proporcionado en el archivo 002-llamada desde PHP.php. Este script permite enviar una solicitud a un servidor de inteligencia artificial llamado Ollama, que procesa la solicitud y devuelve una respuesta. El alumno debe entender cómo funciona esta comunicación entre el cliente (PHP) y el servidor (Ollama).

Desarrollo técnico correcto y preciso (25%): El estudiante debe modificar el archivo 002-llamada desde PHP.php para adaptarlo a un nuevo escenario. Por ejemplo, en lugar de responder preguntas sobre alimentos, el script debería ser capaz de proporcionar recomendaciones de actividades o lugares a visitar basándose en la información del usuario. El alumno debe asegurarse de que su solicitud se envíe correctamente al servidor Ollama y que reciba una respuesta adecuada.

Aplicación práctica con ejemplo claro (25%): El estudiante debe probar su script modificado y verificar que funcione según lo esperado. Para hacer esto, el alumno puede usar herramientas como Postman o simplemente ejecutar el script localmente en un entorno de desarrollo adecuado. Además, el estudiante debe documentar los cambios realizados en el código y explicar cómo funcionan las partes modificadas.

Cierre/Conclusión enlazando con la unidad (25%): El estudiante debe reflexionar sobre cómo este ejercicio se relaciona con lo aprendido en la unidad sobre interacción entre sistemas. Debe pensar en cómo los conceptos teóricos pueden ser aplicados en situaciones prácticas y cómo esto puede mejorar su comprensión del tema.

Para integrar hobbie del alumno, el estudiante podría explorar cómo sus intereses como juegos de mesa o series/películas podrían influir en la elección de las actividades o lugares recomendados por su script. Por ejemplo, si el estudiante disfruta de los videojuegos, podría adaptar el script para sugerir nuevos juegos basándose en preferencias del usuario.



Respuesta:


En esta actividad practico cómo se comunican dos sistemas entre sí. Para ello utilizo un archivo PHP llamado “002-llamada desde PHP.php”, que funciona como un cliente. Este archivo manda una petición a un servidor de inteligencia artificial llamado Ollama.

Primero entiendo cómo funciona el ejemplo original: desde PHP se envía un prompt (una pregunta o instrucción) usando una petición HTTP, y el servidor Ollama responde con un texto generado por un modelo. La respuesta vuelve en formato JSON, y luego PHP la muestra en la página web.

Después de entenderlo, modifico el script para adaptarlo a otro caso. En vez de preguntar por alimentos, cambio el prompt para que el sistema me devuelva recomendaciones de planes o lugares para visitar, según el perfil del usuario. También incluyo hobbies como juegos de mesa, series o videojuegos, para que las recomendaciones sean más personalizadas.

```
<?php
ini_set('display_errors', '1');
ini_set('display_startup_errors', '1');
error_reporting(E_ALL);

function h($s): string { return htmlspecialchars((string)$s, ENT_QUOTES, 'UTF-8'); }

$defaultProfile = [
  "ciudad" => "Madrid",
  "presupuesto" => "medio",
  "tiempo_disponible" => "tarde",
  "preferencias" => ["cultural", "tranquilo"],
  "hobbies" => [
    "juegos_de_mesa" => ["Catan", "Carcassonne"],
    "series_peliculas" => ["ciencia ficción", "misterio"],
    "videojuegos" => ["aventura", "RPG"]
  ]
];

$ciudad = $_POST["ciudad"] ?? $defaultProfile["ciudad"];
$presupuesto = $_POST["presupuesto"] ?? $defaultProfile["presupuesto"];
$tiempo = $_POST["tiempo"] ?? $defaultProfile["tiempo_disponible"];
$hobbyMesa = $_POST["hobbyMesa"] ?? implode(", ", $defaultProfile["hobbies"]["juegos_de_mesa"]);
$hobbySeries = $_POST["hobbySeries"] ?? implode(", ", $defaultProfile["hobbies"]["series_peliculas"]);
$hobbyVideojuegos = $_POST["hobbyVideojuegos"] ?? implode(", ", $defaultProfile["hobbies"]["videojuegos"]);

$userProfile = [
  "ciudad" => trim($ciudad),
  "presupuesto" => trim($presupuesto),
  "tiempo_disponible" => trim($tiempo),
  "hobbies" => [
    "juegos_de_mesa" => array_values(array_filter(array_map("trim", explode(",", $hobbyMesa)))),
    "series_peliculas" => array_values(array_filter(array_map("trim", explode(",", $hobbySeries)))),
    "videojuegos" => array_values(array_filter(array_map("trim", explode(",", $hobbyVideojuegos))))
  ]
];


$defaultPrompt =
"Actúa como recomendador de actividades y lugares.
Con el perfil del usuario, sugiere 5 planes realistas en su ciudad.
Requisitos:
- Ajustados a presupuesto y tiempo disponible.
- Integra hobbies en al menos 2 planes (juegos de mesa / series-películas / videojuegos).
- Responde SOLO con la lista y este formato por plan:

1) Título
2) Descripción (1-2 frases)
3) Por qué encaja (1 frase)
4) Coste (bajo/medio/alto)

Perfil del usuario (JSON):
" . json_encode($userProfile, JSON_UNESCAPED_UNICODE | JSON_PRETTY_PRINT);

$model   = $_POST["model"]   ?? "llama3:latest";
$prompt  = $_POST["prompt"]  ?? $defaultPrompt;
$baseUrl = $_POST["baseUrl"] ?? "http://127.0.0.1:11434";

$result = null;

if ($_SERVER["REQUEST_METHOD"] === "POST") {
  $prompt = trim($prompt);
  if ($prompt === "") $prompt = $defaultPrompt;

  $payload = [
    "model"  => $model,
    "prompt" => $prompt,
    "stream" => false,
    "options" => [
      "temperature" => 0.7
    ]
  ];

  $url = rtrim($baseUrl, "/") . "/api/generate";

  $ch = curl_init($url);
  curl_setopt_array($ch, [
    CURLOPT_POST           => true,
    CURLOPT_RETURNTRANSFER => true,
    CURLOPT_HTTPHEADER     => ["Content-Type: application/json"],
    CURLOPT_POSTFIELDS     => json_encode($payload, JSON_UNESCAPED_UNICODE),
    CURLOPT_CONNECTTIMEOUT => 5,
    CURLOPT_TIMEOUT        => 90,
  ]);

  $raw = curl_exec($ch);
  $httpCode = (int)curl_getinfo($ch, CURLINFO_HTTP_CODE);
  $curlErr  = curl_error($ch);
  curl_close($ch);

  if ($raw === false) {
    $result = ["ok" => false, "err" => "cURL error: " . $curlErr, "out" => ""];
  } elseif ($httpCode < 200 || $httpCode >= 300) {
    $result = ["ok" => false, "err" => "HTTP $httpCode\n$raw", "out" => ""];
  } else {
    $json = json_decode($raw, true);
    if (!is_array($json)) {
      $result = ["ok" => false, "err" => "Respuesta no-JSON:\n$raw", "out" => ""];
    } else {
      $result = ["ok" => true, "out" => (string)($json["response"] ?? ""), "err" => ""];
    }
  }
}
?>
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ollama Web (PHP → Recomendador de planes)</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;max-width:900px;margin:40px auto;padding:0 16px;line-height:1.4}
    .card{border:1px solid #e5e5e5;border-radius:12px;padding:16px;margin:16px 0}
    label{display:block;font-weight:600;margin:10px 0 6px}
    textarea,input,select{width:100%;padding:10px;border:1px solid #d6d6d6;border-radius:10px;font:inherit}
    textarea{min-height:140px}
    button{padding:10px 14px;border:0;border-radius:10px;cursor:pointer;font-weight:600}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    pre{white-space:pre-wrap;word-wrap:break-word;background:#0b0b0b;color:#f1f1f1;padding:12px;border-radius:12px;overflow:auto}
    .err{background:#fff3f3;border:1px solid #ffd0d0;color:#7a0000;padding:12px;border-radius:12px}
    @media (max-width:700px){.row{grid-template-columns:1fr}}
  </style>
</head>
<body>

<h1>Ollama Web (PHP → Recomendador de planes)</h1>

<div class="card">
  <form method="post">
    <div class="row">
      <div>
        <label for="model">Modelo</label>
        <input id="model" name="model" value="<?=h($model)?>" placeholder="llama3:latest">
      </div>
      <div>
        <label for="baseUrl">Ollama URL</label>
        <input id="baseUrl" name="baseUrl" value="<?=h($baseUrl)?>" placeholder="http://127.0.0.1:11434">
      </div>
    </div>

    <div class="row">
      <div>
        <label for="ciudad">Ciudad</label>
        <input id="ciudad" name="ciudad" value="<?=h($ciudad)?>" placeholder="Madrid">
      </div>
      <div>
        <label for="presupuesto">Presupuesto</label>
        <select id="presupuesto" name="presupuesto">
          <?php
            $opts = ["bajo","medio","alto"];
            foreach ($opts as $opt) {
              $sel = ($presupuesto === $opt) ? "selected" : "";
              echo "<option value='".h($opt)."' $sel>".h($opt)."</option>";
            }
          ?>
        </select>
      </div>
    </div>

    <label for="tiempo">Tiempo disponible</label>
    <input id="tiempo" name="tiempo" value="<?=h($tiempo)?>" placeholder="tarde / mañana / fin de semana...">

    <label for="hobbyMesa">Hobbies: juegos de mesa (separados por comas)</label>
    <input id="hobbyMesa" name="hobbyMesa" value="<?=h($hobbyMesa)?>" placeholder="Catan, Carcassonne">

    <label for="hobbySeries">Hobbies: series/películas (separados por comas)</label>
    <input id="hobbySeries" name="hobbySeries" value="<?=h($hobbySeries)?>" placeholder="ciencia ficción, misterio">

    <label for="hobbyVideojuegos">Hobbies: videojuegos (separados por comas)</label>
    <input id="hobbyVideojuegos" name="hobbyVideojuegos" value="<?=h($hobbyVideojuegos)?>" placeholder="aventura, RPG">

    <label for="prompt">Prompt (editable)</label>
    <textarea id="prompt" name="prompt"><?=h($prompt)?></textarea>

    <div style="margin-top:12px;">
      <button type="submit">Generar recomendaciones</button>
    </div>
  </form>
</div>

<?php if ($result !== null): ?>
  <div class="card">
    <h2>Respuesta</h2>
    <?php if (!$result["ok"]): ?>
      <div class="err"><?=nl2br(h($result["err"]))?></div>
    <?php else: ?>
      <pre><?=h($result["out"])?></pre>
    <?php endif; ?>
  </div>
<?php endif; ?>

<div class="card">
  <small>
    Si aparece HTTP 404/connection refused, revisa que Ollama esté activo y escuchando en esa URL/puerto.
  </small>
</div>

</body>
</html>
```


Respuesta de la web:

A continuación, te presento 5 planes realistas en Madrid ajustados a tu presupuesto y tiempo disponible:

1) Título: "Tarde de juegos de mesa y tapas"
2) Descripción: Disfruta un tarde jugando al Catan y Carcassonne con amigos en el barrio de Malasaña, seguida de una degustación de tapas y cerveza.
3) Por qué encaja: Combina tu hobby de juegos de mesa con la oportunidad de socializar y disfrutar de la vida nocturna madrileña.
4) Coste: Medio

2) Título: "Visita al Museo Nacional de Ciencia y Tecnología"
2) Descripción: Descubre las últimas innovaciones científicas y tecnológicas en el Museo Nacional de Ciencia y Tecnología, con exposiciones interactivas y experimentos.
3) Por qué encaja: Como apasionado de la ciencia ficción, disfrutarás de la variedad de temas y exhibiciones que ofrece este museo.
4) Coste: Bajo

3) Título: "Paseo por el Retiro"
2) Descripción: Disfruta un paseo relajante por el Parque del Retiro, rodeado de naturaleza y arte, con posibilidad de tomar una merienda en la terraza del Palacio de Cristal.
3) Por qué encaja: Como tienes tiempo disponible en la tarde, este plan te permite disfrutar de la naturaleza y el arte sin tener que comprometer tu presupuesto.
4) Coste: Bajo

4) Título: "Maratón de series y películas"
2) Descripción: Disfruta una maratón de episodios de series de ciencia ficción y misterio en la sala de cine La Fuga, seguida de un debate sobre tus favoritas.
3) Por qué encaja: Como tienes un presupuesto medio, puedes disfrutar de esta experiencia sin comprometer tu economía.
4) Coste: Medio

5) Título: "Día de aventura en la ruta del Imperio Romano"
2) Descripción: Descubre el legado romano en Madrid a través de una ruta guiada que incluye monumentos como el Arco de Triunfo y el Palacio de Velázquez.
3) Por qué encaja: Como apasionado de aventuras, disfrutarás del descubrimiento de la historia y la arquitectura romana en Madrid.
4) Coste: Alto



Terminal:

serena@serena-portatil:/var/www/html/DAM/DAM1/Bases de datos/Actividades/tema 8$ ss -ltnp | grep 11434
serena@serena-portatil:/var/www/html/DAM/DAM1/Bases de datos/Actividades/tema 8$ sudo systemctl status ollama
[sudo] contraseña para serena: 
Unit ollama.service could not be found.
serena@serena-portatil:/var/www/html/DAM/DAM1/Bases de datos/Actividades/tema 8$ ^C
serena@serena-portatil:/var/www/html/DAM/DAM1/Bases de datos/Actividades/tema 8$ which ollama
ollama --version
No se ha encontrado la orden «ollama», pero se puede instalar con:
sudo snap install ollama
serena@serena-portatil:/var/www/html/DAM/DAM1/Bases de datos/Actividades/tema 8$ curl -fsSL https://ollama.com/install.sh | sh
No se ha encontrado la orden «curl», pero se puede instalar con:
sudo snap install curl  # version 8.17.0, or
sudo apt  install curl  # version 8.5.0-2ubuntu10.6
Consulte «snap info curl» para ver más versiones.
serena@serena-portatil:/var/www/html/DAM/DAM1/Bases de datos/Actividades/tema 8$ sudo apt update
sudo apt install -y curl
Obj:1 http://security.ubuntu.com/ubuntu noble-security InRelease
Ign:2 https://apt.packages.shiftkey.dev/ubuntu any InRelease                   
Obj:3 http://es.archive.ubuntu.com/ubuntu noble InRelease                      
Des:4 http://es.archive.ubuntu.com/ubuntu noble-updates InRelease [126 kB]
Obj:5 http://es.archive.ubuntu.com/ubuntu noble-backports InRelease
Des:6 http://es.archive.ubuntu.com/ubuntu noble-updates/main amd64 Packages [1.717 kB]
Ign:2 https://apt.packages.shiftkey.dev/ubuntu any InRelease
Des:7 http://es.archive.ubuntu.com/ubuntu noble-updates/universe amd64 Packages [1.526 kB]
Des:8 http://es.archive.ubuntu.com/ubuntu noble-updates/multiverse amd64 Packages [32,1 kB]
Ign:2 https://apt.packages.shiftkey.dev/ubuntu any InRelease
Err:2 https://apt.packages.shiftkey.dev/ubuntu any InRelease                   
  Certificate verification failed: The certificate is NOT trusted. The name in the certificate does not match the expected.  Could not handshake: Error in the certificate verification. [IP: 13.107.213.43 443]
Descargados 3.401 kB en 7s (462 kB/s)                                          
Leyendo lista de paquetes... Hecho
Creando árbol de dependencias... Hecho
Leyendo la información de estado... Hecho
Se pueden actualizar 166 paquetes. Ejecute «apt list --upgradable» para verlos.
W: Fallo al obtener https://apt.packages.shiftkey.dev/ubuntu/dists/any/InRelease  Certificate verification failed: The certificate is NOT trusted. The name in the certificate does not match the expected.  Could not handshake: Error in the certificate verification. [IP: 13.107.213.43 443]
W: No se han podido descargar algunos archivos de índice, se han omitido, o se han utilizado unos antiguos en su lugar.
Leyendo lista de paquetes... Hecho
Creando árbol de dependencias... Hecho
Leyendo la información de estado... Hecho
El paquete indicado a continuación se instaló de forma automática y ya no es necesario.
  libllvm19
Utilice «sudo apt autoremove» para eliminarlo.
Se instalarán los siguientes paquetes NUEVOS:
  curl
0 actualizados, 1 nuevos se instalarán, 0 para eliminar y 166 no actualizados.
Se necesita descargar 226 kB de archivos.
Se utilizarán 534 kB de espacio de disco adicional después de esta operación.
Des:1 http://es.archive.ubuntu.com/ubuntu noble-updates/main amd64 curl amd64 8.5.0-2ubuntu10.6 [226 kB]
Descargados 226 kB en 0s (481 kB/s)
Seleccionando el paquete curl previamente no seleccionado.
(Leyendo la base de datos ... 161236 ficheros o directorios instalados actualmen
te.)
Preparando para desempaquetar .../curl_8.5.0-2ubuntu10.6_amd64.deb ...
Desempaquetando curl (8.5.0-2ubuntu10.6) ...
Configurando curl (8.5.0-2ubuntu10.6) ...
Procesando disparadores para man-db (2.12.0-4build2) ...
serena@serena-portatil:/var/www/html/DAM/DAM1/Bases de datos/Actividades/tema 8$ curl --version
curl 8.5.0 (x86_64-pc-linux-gnu) libcurl/8.5.0 OpenSSL/3.0.13 zlib/1.3 brotli/1.1.0 zstd/1.5.5 libidn2/2.3.7 libpsl/0.21.2 (+libidn2/2.3.7) libssh/0.10.6/openssl/zlib nghttp2/1.59.0 librtmp/2.3 OpenLDAP/2.6.7
Release-Date: 2023-12-06, security patched: 8.5.0-2ubuntu10.6
Protocols: dict file ftp ftps gopher gophers http https imap imaps ldap ldaps mqtt pop3 pop3s rtmp rtsp scp sftp smb smbs smtp smtps telnet tftp
Features: alt-svc AsynchDNS brotli GSS-API HSTS HTTP2 HTTPS-proxy IDN IPv6 Kerberos Largefile libz NTLM PSL SPNEGO SSL threadsafe TLS-SRP UnixSockets zstd
serena@serena-portatil:/var/www/html/DAM/DAM1/Bases de datos/Actividades/tema 8$ curl -fsSL https://ollama.com/install.sh | sh
>>> Installing ollama to /usr/local
>>> Downloading ollama-linux-amd64.tar.zst
######################################################################## 100.0%
>>> Creating ollama user...
>>> Adding ollama user to render group...
>>> Adding ollama user to video group...
>>> Adding current user to ollama group...
>>> Creating ollama systemd service...
>>> Enabling and starting ollama service...
Created symlink /etc/systemd/system/default.target.wants/ollama.service → /etc/systemd/system/ollama.service.
>>> NVIDIA GPU installed.
serena@serena-portatil:/var/www/html/DAM/DAM1/Bases de datos/Actividades/tema 8$ systemctl status ollama --no-pager
● ollama.service - Ollama Service
     Loaded: loaded (/etc/systemd/system/ollama.service; enabled; preset: enabled)
     Active: active (running) since Sun 2026-02-01 16:57:34 CET; 22s ago
   Main PID: 7341 (ollama)
      Tasks: 14 (limit: 17997)
     Memory: 13.5M (peak: 252.7M)
        CPU: 2.166s
     CGroup: /system.slice/ollama.service
             └─7341 /usr/local/bin/ollama serve

feb 01 16:57:34 serena-portatil ollama[7341]: time=2026-02-01T16:57:34.541+0… 0"
feb 01 16:57:34 serena-portatil ollama[7341]: time=2026-02-01T16:57:34.541+0…2)"
feb 01 16:57:34 serena-portatil ollama[7341]: time=2026-02-01T16:57:34.542+0….."
feb 01 16:57:34 serena-portatil ollama[7341]: time=2026-02-01T16:57:34.542+0…85"
feb 01 16:57:36 serena-portatil ollama[7341]: time=2026-02-01T16:57:36.592+0…17"
feb 01 16:57:36 serena-portatil ollama[7341]: time=2026-02-01T16:57:36.748+0…=1"
feb 01 16:57:36 serena-portatil ollama[7341]: time=2026-02-01T16:57:36.749+0…19"
feb 01 16:57:36 serena-portatil ollama[7341]: time=2026-02-01T16:57:36.749+0…39"
feb 01 16:57:36 serena-portatil ollama[7341]: time=2026-02-01T16:57:36.907+01:0…
feb 01 16:57:36 serena-portatil ollama[7341]: time=2026-02-01T16:57:36.907+0…iB"
Hint: Some lines were ellipsized, use -l to show in full.
serena@serena-portatil:/var/www/html/DAM/DAM1/Bases de datos/Actividades/tema 8$ ss -ltnp | grep 11434
LISTEN 0      4096       127.0.0.1:11434      0.0.0.0:*          
serena@serena-portatil:/var/www/html/DAM/DAM1/Bases de datos/Actividades/tema 8$ curl http://127.0.0.1:11434/api/tags
{"models":[]}serena@serena-portatil:/var/www/html/DAM/DAM1/Bases de datos/Actividollama list$ ollama list
NAME    ID    SIZE    MODIFIED 
serena@serena-portatil:/var/www/html/DAM/DAM1/Bases de datos/Actividades/tema 8$ ^C
serena@serena-portatil:/var/www/html/DAM/DAM1/Bases de datos/Actividades/tema 8$ ollama pull llama3
pulling manifest 
pulling 6a0746a1ec1a: 100% ▕██████████████████▏ 4.7 GB                         
pulling 4fa551d4f938: 100% ▕██████████████████▏  12 KB                         
pulling 8ab4849b038c: 100% ▕██████████████████▏  254 B                         
pulling 577073ffcc6c: 100% ▕██████████████████▏  110 B                         
pulling 3f8eb4da87fa: 100% ▕██████████████████▏  485 B                         
verifying sha256 digest 
writing manifest 
success 
serena@serena-portatil:/var/www/html/DAM/DAM1/Bases de datos/Actividades/tema 8$ ollama list
NAME             ID              SIZE      MODIFIED       
llama3:latest    365c0bd3c000    4.7 GB    43 seconds ago    
serena@serena-portatil:/var/www/html/DAM/DAM1/Bases de datos/Actividades/tema 8$ 


Con este ejercicio aprendo de forma práctica cómo funciona la interacción entre sistemas, porque veo claramente cómo una aplicación hecha en PHP puede conectarse con un servidor externo como Ollama y recibir una respuesta.

Durante el desarrollo me doy cuenta de que no solo importa el código, sino también que el servidor esté funcionando, que el modelo esté instalado y que la URL sea correcta. Al final consigo que el script se conecte bien con Ollama, envíe la información y reciba las recomendaciones sin errores.

Además, al incluir hobbies como juegos de mesa, series y videojuegos, entiendo que la inteligencia artificial puede dar respuestas más útiles si le doy datos más específicos del usuario. En general, este ejercicio me ayuda a comprender mejor lo visto en el tema, porque aplico la teoría de la comunicación entre sistemas en un caso real.
