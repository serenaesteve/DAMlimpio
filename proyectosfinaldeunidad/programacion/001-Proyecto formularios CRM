En este proyecto he partido de un ejercicio realizado en clase y lo he mejorado para adaptarlo a un caso real. El objetivo ha sido crear un pequeño CRM personal para gestionar contactos de forma sencilla. A lo largo del trabajo he aplicado conocimientos de HTML, CSS, PHP y bases de datos, intentando que el proyecto sea práctico y fácil de usar.



1. Creo la base de datos:
```
serena@serena-portatil:~$ sudo mysql
[sudo] contraseña para serena: 
Lo siento, pruebe otra vez.
[sudo] contraseña para serena: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 10
Server version: 8.0.45-0ubuntu0.24.04.1 (Ubuntu)

Copyright (c) 2000, 2026, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> CREATE DATABASE IF NOT EXISTS crm_serena
    ->   CHARACTER SET utf8mb4
    ->   COLLATE utf8mb4_unicode_ci;
Query OK, 1 row affected (0,01 sec)

mysql> 
mysql> USE crm_serena;
Database changed
mysql> 
mysql> CREATE USER IF NOT EXISTS 'crm_serena_user'@'localhost' IDENTIFIED BY 'PonUnaClaveFuerteAqui';
Query OK, 0 rows affected (0,01 sec)

mysql> GRANT ALL PRIVILEGES ON crm_serena.* TO 'crm_serena_user'@'localhost';
Query OK, 0 rows affected (0,01 sec)

mysql> FLUSH PRIVILEGES;
Query OK, 0 rows affected (0,00 sec)

mysql> ALTER USER 'crm_serena_user'@'localhost' IDENTIFIED BY 'Serena2026!CRM';
Query OK, 0 rows affected (0,01 sec)

mysql> FLUSH PRIVILEGES;
Query OK, 0 rows affected (0,00 sec)

mysql> CREATE TABLE IF NOT EXISTS leads (
    ->   id INT AUTO_INCREMENT PRIMARY KEY,
    ->   created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    -> 
    ->   nombre VARCHAR(120) NOT NULL,
    ->   email VARCHAR(190) NOT NULL,
    ->   telefono VARCHAR(40) NULL,
    -> 
    ->   servicio ENUM('Web','Ecommerce','SEO','Mantenimiento','Consultoría','Otro') NOT NULL DEFAULT 'Web',
    ->   presupuesto DECIMAL(10,2) NULL,
    ->   deadline DATE NULL,
    -> 
    ->   origen ENUM('Web','Instagram','LinkedIn','Referido','Email','Otro') NOT NULL DEFAULT 'Web',
    -> 
    ->   mensaje TEXT NULL,
    ->   consentimiento TINYINT(1) NOT NULL DEFAULT 0,
    -> 
    ->   estado ENUM('Nuevo','Contactado','Reunión agendada','Presupuesto enviado','Ganado','Perdido') NOT NULL DEFAULT 'Nuevo',
    ->   proximo_seguimiento DATE NULL,
    ->   notas_internas TEXT NULL
    -> ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
Query OK, 0 rows affected, 1 warning (0,04 sec)

mysql> 
mysql> CREATE TABLE IF NOT EXISTS admin_users (
    ->   id INT AUTO_INCREMENT PRIMARY KEY,
    ->   username VARCHAR(60) NOT NULL UNIQUE,
    ->   password_hash VARCHAR(255) NOT NULL,
    ->   created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
    -> ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
Query OK, 0 rows affected (0,02 sec)

mysql> 
mysql> CREATE TABLE IF NOT EXISTS mail_log (
    ->   id INT AUTO_INCREMENT PRIMARY KEY,
    ->   lead_id INT NOT NULL,
    ->   to_email VARCHAR(190) NOT NULL,
    ->   subject VARCHAR(255) NOT NULL,
    ->   body TEXT NOT NULL,
    ->   sent_ok TINYINT(1) NOT NULL DEFAULT 0,
    ->   error_msg TEXT NULL,
    ->   created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    ->   FOREIGN KEY (lead_id) REFERENCES leads(id) ON DELETE CASCADE
    -> ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
Query OK, 0 rows affected, 1 warning (0,03 sec)

mysql> 
mysql> CREATE INDEX idx_leads_estado ON leads(estado);
Query OK, 0 rows affected (0,03 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> CREATE INDEX idx_leads_email  ON leads(email);
Query OK, 0 rows affected (0,02 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> CREATE INDEX idx_leads_fecha  ON leads(created_at);
Query OK, 0 rows affected (0,02 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> exit;
Bye
serena@serena-portatil:~$ mysql -u crm_serena_user -p
Enter password: 
ERROR 1045 (28000): Access denied for user 'crm_serena_user'@'localhost' (using password: YES)
serena@serena-portatil:~$ mysql -u crm_serena_user -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 12
Server version: 8.0.45-0ubuntu0.24.04.1 (Ubuntu)

Copyright (c) 2000, 2026, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> exit;
Bye
serena@serena-portatil:~$ 
```


01-hash.php:

Se usa para generar contraseñas cifradas de forma segura.


```
<?php

$pass = $_GET['pass'] ?? '';
if ($pass === '') die("Pasa la clave así: ?pass=TUCLAVE");

echo "<pre>";
echo password_hash($pass, PASSWORD_DEFAULT);
echo "</pre>";
```

006-funciones.php:

Contiene funciones reutilizables del proyecto, como gestión de estados, correos e informes.


```
<?php

function cfg(): array {
  static $cfg = null;
  if ($cfg === null) $cfg = require __DIR__ . "/config.php";
  return $cfg;
}

function db(): mysqli {
  static $c = null;
  if ($c) return $c;

  $db = cfg()["db"];
  $c = new mysqli($db["host"], $db["user"], $db["pass"], $db["name"]);
  if ($c->connect_error) die("Error BD: " . $c->connect_error);
  $c->set_charset("utf8mb4");
  return $c;
}

function start_session(): void {
  $name = cfg()["session_name"] ?? "crm_session";
  if (session_status() !== PHP_SESSION_ACTIVE) {
    session_name($name);
    session_start();
  }
}

function h($v): string {
  return htmlspecialchars((string)$v, ENT_QUOTES, 'UTF-8');
}


function csrf_token(): string {
  start_session();
  if (empty($_SESSION["csrf"])) $_SESSION["csrf"] = bin2hex(random_bytes(32));
  return $_SESSION["csrf"];
}
function csrf_check(): void {
  start_session();
  $ok = isset($_POST["csrf"]) && hash_equals($_SESSION["csrf"] ?? "", $_POST["csrf"]);
  if (!$ok) { http_response_code(403); die("CSRF inválido"); }
}


function is_logged(): bool {
  start_session();
  return !empty($_SESSION["admin_logged"]);
}
function require_login(): void {
  if (!is_logged()) { header("Location: admin.php"); exit; }
}
function login_attempt(string $username, string $password, string &$error): bool {
  $error = "";
  $c = db();
  $stmt = $c->prepare("SELECT password_hash FROM admin_users WHERE username=? LIMIT 1");
  if (!$stmt) { $error = "Error interno."; return false; }
  $stmt->bind_param("s", $username);
  $stmt->execute();
  $row = $stmt->get_result()->fetch_assoc();
  $stmt->close();

  if (!$row || !password_verify($password, $row["password_hash"])) {
    $error = "Usuario o contraseña incorrectos.";
    return false;
  }

  start_session();
  session_regenerate_id(true);
  $_SESSION["admin_logged"] = true;
  $_SESSION["admin_user"] = $username;
  return true;
}
function logout(): void {
  start_session();
  $_SESSION = [];
  session_destroy();
}


function ensure_admin_bootstrap(): void {
  $cfg = cfg();
  $b = $cfg["admin_bootstrap"] ?? ["enabled"=>false];

  if (empty($b["enabled"])) return;

  $user = $b["username"] ?? "";
  $pass = $b["password"] ?? "";
  if ($user === "" || $pass === "") return;

  $c = db();


  $stmt = $c->prepare("SELECT id FROM admin_users WHERE username=? LIMIT 1");
  if (!$stmt) return;
  $stmt->bind_param("s", $user);
  $stmt->execute();
  $exists = (bool)$stmt->get_result()->fetch_assoc();
  $stmt->close();

  if ($exists) return;

  $hash = password_hash($pass, PASSWORD_DEFAULT);

  $stmt = $c->prepare("INSERT INTO admin_users(username,password_hash) VALUES (?,?)");
  if (!$stmt) return;
  $stmt->bind_param("ss", $user, $hash);
  $stmt->execute();
  $stmt->close();
}


function estados_crm(): array {
  return [
    'Nuevo'               => '#3498db',
    'Contactado'          => '#9b59b6',
    'Reunión agendada'    => '#f1c40f',
    'Presupuesto enviado' => '#e67e22',
    'Ganado'              => '#2ecc71',
    'Perdido'             => '#e74c3c',
  ];
}
function servicios(): array {
  return ['Desarrollo web'];
}
function origenes(): array {
  return ['Web','Instagram','LinkedIn','Referido','Email','Otro'];
}


function lead_create(array $data, string &$msg, ?int &$newId = null): bool {
  $msg = "";
  $newId = null;

  $c = db();
  $nombre = trim($data["nombre"] ?? "");
  $email  = trim($data["email"] ?? "");
  $telefono = trim($data["telefono"] ?? "");

  $servicio = $data["servicio"] ?? "Desarrollo web";
  $presupuesto = ($data["presupuesto"] ?? "") !== "" ? (float)$data["presupuesto"] : null;
  $deadline = ($data["deadline"] ?? "") !== "" ? $data["deadline"] : null;

  $origen = $data["origen"] ?? "Web";
  $mensaje = trim($data["mensaje"] ?? "");
  $consent = isset($data["consentimiento"]) ? 1 : 0;


  if ($nombre === "" || $email === "" || $telefono === "" || $mensaje === "") {
    $msg = "Faltan campos obligatorios.";
    return false;
  }
  if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
    $msg = "Email no válido.";
    return false;
  }
  if ($consent !== 1) {
    $msg = "Debes aceptar la política de privacidad.";
    return false;
  }

  $stmt = $c->prepare("
    INSERT INTO leads (nombre,email,telefono,servicio,presupuesto,deadline,origen,mensaje,consentimiento)
    VALUES (?,?,?,?,?,?,?,?,?)
  ");
  if (!$stmt) { $msg="Error interno."; return false; }

  $stmt->bind_param("ssssdsssi",
    $nombre, $email, $telefono, $servicio, $presupuesto, $deadline, $origen, $mensaje, $consent
  );

  $ok = $stmt->execute();
  $err = $stmt->error;
  $stmt->close();

  if (!$ok) { $msg = "No se pudo guardar: ".$err; return false; }

  $newId = (int)$c->insert_id;
  return true;
}

function lead_get(int $id): ?array {
  $c = db();
  $stmt = $c->prepare("SELECT * FROM leads WHERE id=? LIMIT 1");
  if (!$stmt) return null;
  $stmt->bind_param("i", $id);
  $stmt->execute();
  $row = $stmt->get_result()->fetch_assoc();
  $stmt->close();
  return $row ?: null;
}

function lead_update_crm(int $id, string $estado, ?string $proximo, ?string $notas): bool {
  $c = db();
  $stmt = $c->prepare("UPDATE leads SET estado=?, proximo_seguimiento=?, notas_internas=? WHERE id=?");
  if (!$stmt) return false;
  $stmt->bind_param("sssi", $estado, $proximo, $notas, $id);
  $ok = $stmt->execute();
  $stmt->close();
  return $ok;
}

function leads_list(array $filters, int $page, int $perPage, int &$total): array {
  $c = db();
  $where = [];
  $params = [];
  $types = "";

  if (!empty($filters["q"])) {
    $where[] = "(nombre LIKE ? OR email LIKE ? OR telefono LIKE ?)";
    $q = "%".$filters["q"]."%";
    $params[]=$q; $params[]=$q; $params[]=$q;
    $types .= "sss";
  }

  if (!empty($filters["estado"]) && $filters["estado"] !== "ALL") {
    $where[] = "estado=?";
    $params[] = $filters["estado"];
    $types .= "s";
  }

  $sqlWhere = $where ? ("WHERE ".implode(" AND ", $where)) : "";


  $stmtT = $c->prepare("SELECT COUNT(*) n FROM leads $sqlWhere");
  if ($stmtT) {
    if ($types !== "") $stmtT->bind_param($types, ...$params);
    $stmtT->execute();
    $total = (int)($stmtT->get_result()->fetch_assoc()["n"] ?? 0);
    $stmtT->close();
  } else $total = 0;

  $offset = max(0, ($page-1)*$perPage);
  $sql = "SELECT * FROM leads $sqlWhere ORDER BY created_at DESC LIMIT $perPage OFFSET $offset";
  $stmt = $c->prepare($sql);
  if (!$stmt) return [];
  if ($types !== "") $stmt->bind_param($types, ...$params);
  $stmt->execute();
  $res = $stmt->get_result();
  $rows=[];
  while($r=$res->fetch_assoc()) $rows[]=$r;
  $stmt->close();
  return $rows;
}


function mail_enabled(): bool {
  return !empty(cfg()["mail"]["enabled"]);
}

function crm_append_to_sent(string $rawMessage): void {
  if (!mail_enabled()) return;
  if (!function_exists("imap_open")) return;

  $m = cfg()["mail"];
  $mailbox = $m["imap_sent"];
  $user = $m["smtp_user"];
  $pass = $m["smtp_pass"];

  $imap = @imap_open($mailbox, $user, $pass);
  if (!$imap) return;

  $date = date('d-M-Y H:i:s O');
  @imap_append($imap, $mailbox, $rawMessage, "\\Seen", $date);
  imap_close($imap);
}

function crm_send_email_smtp(string $to, string $subject, string $body, string &$errorMsg): bool {
  $errorMsg = "";
  if (!mail_enabled()) { $errorMsg="Email deshabilitado."; return false; }

  $m = cfg()["mail"];
  $smtpHost = $m["smtp_host"];
  $smtpPort = (int)$m["smtp_port"];
  $username = $m["smtp_user"];
  $password = $m["smtp_pass"];
  $from     = $m["from_email"];
  $fromName = $m["from_name"];

  $socket = @fsockopen($smtpHost, $smtpPort, $errno, $errstr, 30);
  if (!$socket) { $errorMsg="No se pudo conectar SMTP: $errstr ($errno)"; return false; }

  $resp = fgets($socket, 515);
  if (substr($resp,0,3)!='220') { $errorMsg="Banner SMTP inesperado: $resp"; fclose($socket); return false; }

  $readMulti = function($expected) use ($socket, &$errorMsg){
    while(($line=fgets($socket,515))!==false){
      if(substr($line,0,3)!=$expected){ $errorMsg="SMTP inesperado: $line"; return false; }
      if(strlen($line)<4 || $line[3] != '-') break;
    }
    return true;
  };
  $send = function($cmd,$expected) use($socket,&$errorMsg){
    fputs($socket,$cmd);
    $r=fgets($socket,515);
    if(substr($r,0,3)!=$expected){ $errorMsg="SMTP '$cmd' => $r"; return false; }
    return true;
  };

  fputs($socket,"EHLO localhost\r\n"); if(!$readMulti("250")){ fclose($socket); return false; }

  fputs($socket,"STARTTLS\r\n");
  $r=fgets($socket,515);
  if(substr($r,0,3)!="220"){ $errorMsg="STARTTLS falló: $r"; fclose($socket); return false; }

  $cryptoOk = @stream_socket_enable_crypto($socket,true,STREAM_CRYPTO_METHOD_TLS_CLIENT);
  if(!$cryptoOk){ $errorMsg="No se pudo activar TLS."; fclose($socket); return false; }

  fputs($socket,"EHLO localhost\r\n"); if(!$readMulti("250")){ fclose($socket); return false; }

  if(!$send("AUTH LOGIN\r\n","334")){ fclose($socket); return false; }
  if(!$send(base64_encode($username)."\r\n","334")){ fclose($socket); return false; }
  if(!$send(base64_encode($password)."\r\n","235")){ fclose($socket); return false; }

  if(!$send("MAIL FROM:<$from>\r\n","250")){ fclose($socket); return false; }
  if(!$send("RCPT TO:<$to>\r\n","250")){ fclose($socket); return false; }
  if(!$send("DATA\r\n","354")){ fclose($socket); return false; }

  $headers  = "From: ".$fromName." <".$from.">\r\n";
  $headers .= "To: <".$to.">\r\n";
  $headers .= "Subject: ".$subject."\r\n";
  $headers .= "MIME-Version: 1.0\r\n";
  $headers .= "Content-Type: text/plain; charset=UTF-8\r\n";
  $headers .= "Content-Transfer-Encoding: 8bit\r\n\r\n";

  $raw = $headers.$body;
  fputs($socket, $raw . "\r\n.\r\n");

  $r=fgets($socket,515);
  if(substr($r,0,3)!="250"){ $errorMsg="Error al enviar: $r"; fclose($socket); return false; }

  fputs($socket,"QUIT\r\n");
  fclose($socket);

  crm_append_to_sent($raw);
  return true;
}

function crm_fetch_emails_for_contact(string $contactEmail, int $limit = 10): array {
  $out = ["sent"=>[], "received"=>[], "unread"=>false, "error"=>null];
  if (!mail_enabled()) return $out;
  if (!function_exists("imap_open")) { $out["error"]="Extensión IMAP no habilitada."; return $out; }

  $m = cfg()["mail"];
  $user = $m["smtp_user"];
  $pass = $m["smtp_pass"];
  $inboxBox = $m["imap_inbox"];
  $sentBox  = $m["imap_sent"];

  $safeEmail = str_replace('"','\"',$contactEmail);
  $our = strtolower($m["from_email"]);


  $imap = @imap_open($inboxBox, $user, $pass);
  if ($imap) {
    $unseen = imap_search($imap, 'UNSEEN FROM "'.$safeEmail.'"');
    if ($unseen !== false && count($unseen)>0) $out["unread"]=true;
    imap_close($imap);
  }

  $scan = function(string $box) use (&$out,$user,$pass,$safeEmail,$our){
    $imap = @imap_open($box, $user, $pass);
    if(!$imap){ if($out["error"]===null) $out["error"]=imap_last_error(); return; }

    $ids=[];
    $fromIds = imap_search($imap,'FROM "'.$safeEmail.'"'); if($fromIds!==false) $ids=array_merge($ids,$fromIds);
    $toIds   = imap_search($imap,'TO "'.$safeEmail.'"');   if($toIds!==false)   $ids=array_merge($ids,$toIds);
    if(empty($ids)){ imap_close($imap); return; }

    $ids=array_values(array_unique($ids)); rsort($ids);

    foreach($ids as $num){
      $ov = imap_fetch_overview($imap,$num,0); if(!$ov) continue; $ov=$ov[0];
      $header = imap_headerinfo($imap,$num);
      $from = $header->fromaddress ?? ($ov->from ?? "");
      $to   = $header->toaddress ?? ($ov->to ?? "");
      $subject = isset($ov->subject) ? imap_utf8($ov->subject) : "";
      $date = $ov->date ?? "";

      $body = imap_fetchbody($imap,$num,1) ?: "";
      $body = imap_qprint($body);
      $snippet = trim($body);
      $snippet = function_exists("mb_substr") ? mb_substr($snippet,0,200) : substr($snippet,0,200);

      $entry=["subject"=>$subject,"date"=>$date,"from"=>$from,"to"=>$to,"snippet"=>$snippet];
      if (strpos(strtolower($from), $our) !== false) $out["sent"][]=$entry;
      else $out["received"][]=$entry;
    }

    imap_close($imap);
  };

  $scan($inboxBox);
  $scan($sentBox);

  $sort = function(&$arr){
    usort($arr, fn($a,$b)=> (strtotime($b["date"]??"") <=> strtotime($a["date"]??"")));
  };
  $sort($out["sent"]); $sort($out["received"]);
  $out["sent"]=array_slice($out["sent"],0,$limit);
  $out["received"]=array_slice($out["received"],0,$limit);

  return $out;
}


function mail_log_add(int $leadId, string $to, string $subject, string $body, bool $ok, ?string $err): void {
  $c = db();
  $stmt = $c->prepare("INSERT INTO mail_log(lead_id,to_email,subject,body,sent_ok,error_msg) VALUES (?,?,?,?,?,?)");
  if(!$stmt) return;
  $sent_ok = $ok ? 1 : 0;
  $stmt->bind_param("isssis",$leadId,$to,$subject,$body,$sent_ok,$err);
  $stmt->execute();
  $stmt->close();
}


function send_auto_emails_new_lead(array $leadRow): void {
  if (!mail_enabled()) return;

  $m = cfg()["mail"];
  $domain = cfg()["app"]["domain"] ?? "";

  $client = $leadRow["email"];
  $name = $leadRow["nombre"];
  $servicio = $leadRow["servicio"];


  if (!empty($m["auto_reply_client"])) {
    $subject = "Hemos recibido tu solicitud - CRM Serena Sania";
    $body =
"Hola $name,

¡Gracias por contactar conmigo! He recibido tu solicitud sobre: $servicio.

En breve te responderé para concretar detalles.

Un saludo,
Serena Sania Esteve
$domain
";
    $err="";
    $ok = crm_send_email_smtp($client,$subject,$body,$err);
    mail_log_add((int)$leadRow["id"], $client, $subject, $body, $ok, $ok ? null : $err);
  }


  if (!empty($m["auto_notify_owner"])) {
    $owner = $m["from_email"];
    $subject = "Nuevo lead recibido: ".$leadRow["nombre"];
    $body =
"Nuevo lead en $domain

Nombre: ".$leadRow["nombre"]."
Email: ".$leadRow["email"]."
Teléfono: ".$leadRow["telefono"]."
Servicio: ".$leadRow["servicio"]."
Presupuesto: ".$leadRow["presupuesto"]."
Fecha límite: ".$leadRow["deadline"]."
Origen: ".$leadRow["origen"]."

Mensaje:
".$leadRow["mensaje"]."
";
    $err="";
    $ok = crm_send_email_smtp($owner,$subject,$body,$err);
    mail_log_add((int)$leadRow["id"], $owner, $subject, $body, $ok, $ok ? null : $err);
  }
}
```

config.php:

Contiene la configuración general del proyecto, como la conexión a la base de datos y los datos principales del CRM.


```
<?php
return [
  "app" => [
    "name" => "CRM Serena Sania",
    "owner" => "Serena Sania Esteve",
    "domain" => "crmserenasania.com",
    "default_lang" => "es",           
    "enabled_langs" => ["es", "en"],  
  ],

  "db" => [
    "host" => "localhost",
    "user" => "crm_serena_user",
    "pass" => "Serena2026!CRM",  
    "name" => "crm_serena",
  ],

  "session_name" => "crm_serena_session",


  "admin_bootstrap" => [
    "enabled" => true,
    "username" => "serena",
    "password" => "1463"
  ],


  "mail" => [
    "enabled" => true,

    "from_name" => "CRM Serena Sania",
    "from_email" => "serenaestevee@gmail.com",

    "smtp_host" => "smtp.gmail.com",
    "smtp_port" => 587,
    "smtp_user" => "serenaestevee@gmail.com",
    "smtp_pass" => "mbgz lpoo gdvd gegs", 

    "imap_inbox" => "{imap.gmail.com:993/imap/ssl}INBOX",
    "imap_sent"  => "{imap.gmail.com:993/imap/ssl}[Gmail]/Sent Mail",


    "auto_reply_client" => true,
    "auto_notify_owner" => true,
    "auto_emails_language" => "es" 
  ],
]
```

i18n.php:

Se encarga del sistema de idiomas (español e inglés) y permite cambiar el idioma de la web.


```
<?php
require_once __DIR__ . "/006-funciones.php";

function set_lang_from_request(): void {
  start_session();
  $cfg = cfg();
  $enabled = $cfg["app"]["enabled_langs"] ?? ["es","en"];
  $default = $cfg["app"]["default_lang"] ?? "es";

  if (isset($_GET["lang"]) && in_array($_GET["lang"], $enabled, true)) {
    $_SESSION["lang"] = $_GET["lang"];
  }
  if (empty($_SESSION["lang"])) $_SESSION["lang"] = $default;
}

function lang(): string {
  start_session();
  return $_SESSION["lang"] ?? "es";
}

function t(string $key): string {
  $L = lang();
  $dict = i18n_dict();
  return $dict[$L][$key] ?? $dict["es"][$key] ?? $key;
}

function i18n_dict(): array {
  return [
    "es" => [
      "public_title" => "Solicitar presupuesto",
      "public_subtitle" => "Cuéntame tu proyecto y te responderé lo antes posible.",
      "name" => "Nombre",
      "email" => "Email",
      "phone" => "Teléfono",
      "service" => "Servicio",
      "budget" => "Presupuesto",
      "deadline" => "Fecha límite",
      "source" => "¿Cómo me conociste?",
      "message" => "Mensaje",
      "privacy" => "Acepto la política de privacidad",
      "send" => "Enviar",
      "thanks_title" => "¡Gracias!",
      "thanks_text" => "He recibido tu mensaje. Te responderé lo antes posible.",
      "admin_access" => "Acceso al panel",
      "username" => "Usuario",
      "password" => "Contraseña",
      "login" => "Entrar",
      "logout" => "Cerrar sesión",
      "leads" => "Leads",
      "new_lead" => "Nuevo lead",
      "status" => "Estado",
      "next_followup" => "Próximo seguimiento",
      "actions" => "Acciones",
      "view" => "Ver",
      "save" => "Guardar",
      "notes" => "Notas internas",
      "detail" => "Detalle",
      "email_center" => "Correo",
      "send_email" => "Enviar email",
      "subject" => "Asunto",
      "body" => "Mensaje",
      "sent_ok" => "Mensaje enviado correctamente.",
      "sent_error" => "Error al enviar el mensaje",
      "unread" => "No leídos",
      "search" => "Buscar",
      "reset" => "Limpiar",
      "all" => "Todos",
    ],
    "en" => [
      "public_title" => "Request a quote",
      "public_subtitle" => "Tell me about your project and I’ll reply as soon as possible.",
      "name" => "Name",
      "email" => "Email",
      "phone" => "Phone",
      "service" => "Service",
      "budget" => "Budget",
      "deadline" => "Deadline",
      "source" => "How did you find me?",
      "message" => "Message",
      "privacy" => "I accept the privacy policy",
      "send" => "Send",
      "thanks_title" => "Thanks!",
      "thanks_text" => "I’ve received your message. I’ll get back to you soon.",
      "admin_access" => "Admin access",
      "username" => "Username",
      "password" => "Password",
      "login" => "Login",
      "logout" => "Logout",
      "leads" => "Leads",
      "new_lead" => "New lead",
      "status" => "Status",
      "next_followup" => "Next follow-up",
      "actions" => "Actions",
      "view" => "View",
      "save" => "Save",
      "notes" => "Internal notes",
      "detail" => "Detail",
      "email_center" => "Email",
      "send_email" => "Send email",
      "subject" => "Subject",
      "body" => "Message",
      "sent_ok" => "Message sent successfully.",
      "sent_error" => "Error sending message",
      "unread" => "Unread",
      "search" => "Search",
      "reset" => "Reset",
      "all" => "All",
    ],
  ];
}
```

lead.php:

Recibe y procesa los datos enviados desde el formulario y guarda el lead en la base de datos.


```
<?php
require __DIR__ . "/006-funciones.php";
require __DIR__ . "/i18n.php";

set_lang_from_request();
require_login();

$id = (int)($_GET["id"] ?? 0);
$lead = $id ? lead_get($id) : null;
if (!$lead) { http_response_code(404); die("Lead no encontrado"); }

$cfg = cfg();
$colors = estados_crm();
$mensaje = "";

if ($_SERVER["REQUEST_METHOD"] === "POST") {
  csrf_check();

  if (($_POST["action"] ?? "") === "update_crm") {
    $estado = $_POST["estado"] ?? $lead["estado"];
    $proximo = ($_POST["proximo_seguimiento"] ?? "") ?: null;
    $notas = ($_POST["notas_internas"] ?? "") ?: null;

    if (!isset($colors[$estado])) $estado = "Nuevo";
    lead_update_crm($id, $estado, $proximo, $notas);

    header("Location: lead.php?id=".$id."&lang=".urlencode(lang()));
    exit;
  }

  if (($_POST["action"] ?? "") === "send_email") {
    $to = $lead["email"];
    $subject = trim($_POST["subject"] ?? "");
    $body = trim($_POST["body"] ?? "");

    if ($subject === "" || $body === "") {
      $mensaje = h(t("sent_error")) . ": campos vacíos.";
    } else {
      $err = "";
      $ok = crm_send_email_smtp($to, $subject, $body, $err);
      mail_log_add($id, $to, $subject, $body, $ok, $ok ? null : $err);
      $mensaje = $ok ? t("sent_ok") : (t("sent_error") . ": " . $err);
    }

    header("Location: lead.php?id=".$id."&lang=".urlencode(lang())."&m=1");
    exit;
  }
}

$lead = lead_get($id); // refrescar
$comm = mail_enabled() ? crm_fetch_emails_for_contact($lead["email"], 20) : ["sent"=>[],"received"=>[],"unread"=>false,"error"=>null];
$mailLog = mail_log_list($id, 20);
?>
<!doctype html>
<html lang="<?= h(lang()) ?>">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title><?= h($cfg["app"]["name"]) ?> - <?= h(t("detail")) ?></title>
  <link rel="stylesheet" href="public/assets/style.css">
</head>
<body>

<div class="layout">
  <nav class="sidebar">
    <div class="brand">
      <?= h($cfg["app"]["name"]) ?><br>
      <small><?= h($cfg["app"]["owner"]) ?></small>
    </div>

    <a href="panel.php?lang=<?= h(lang()) ?>">&larr; <?= h(t("leads")) ?></a>
    <a href="public/index.php?lang=<?= h(lang()) ?>"><?= h(t("new_lead")) ?></a>
    <a href="logout.php"><?= h(t("logout")) ?></a>

    <div class="langswitch" style="margin-top:auto;">
      <a href="?id=<?= (int)$id ?>&lang=es">ES</a>
      <a href="?id=<?= (int)$id ?>&lang=en">EN</a>
    </div>
  </nav>

  <main class="main">
    <div class="tablecard">
      <h1><?= h(t("detail")) ?> #<?= (int)$lead["id"] ?></h1>

      <div class="notice" style="margin:10px 0;">
        <strong><?= h($lead["nombre"]) ?></strong> — <?= h($lead["email"]) ?> <?= $lead["telefono"] ? " · ".h($lead["telefono"]) : "" ?><br>
        <?= h($lead["servicio"]) ?> <?= $lead["presupuesto"] ? " · €".h($lead["presupuesto"]) : "" ?> <?= $lead["deadline"] ? " · ".h($lead["deadline"]) : "" ?><br>
        <small>Created: <?= h($lead["created_at"]) ?> · Origen: <?= h($lead["origen"]) ?></small>
      </div>

      <div style="display:grid; grid-template-columns:1fr 1fr; gap:14px;">
        <div class="card" style="box-shadow:none;border-top:0;padding:14px;border:1px solid var(--border);">
          <h3 style="margin:0 0 10px;color:var(--primary);"><?= h(t("status")) ?></h3>

          <form method="post">
            <input type="hidden" name="csrf" value="<?= h(csrf_token()) ?>">
            <input type="hidden" name="action" value="update_crm">

            <label><?= h(t("status")) ?></label>
            <select name="estado">
              <?php foreach ($colors as $estado => $color): ?>
                <option value="<?= h($estado) ?>" <?= ($lead["estado"]===$estado ? "selected" : "") ?>>
                  <?= h($estado) ?>
                </option>
              <?php endforeach; ?>
            </select>

            <div style="height:10px;"></div>

            <label><?= h(t("next_followup")) ?></label>
            <input type="date" name="proximo_seguimiento" value="<?= h($lead["proximo_seguimiento"] ?? "") ?>">

            <div style="height:10px;"></div>

            <label><?= h(t("notes")) ?></label>
            <textarea name="notas_internas"><?= h($lead["notas_internas"] ?? "") ?></textarea>

            <div class="actions">
              <button class="btn" type="submit"><?= h(t("save")) ?></button>
              <span class="pill" style="border-color:<?= h($colors[$lead["estado"]] ?? "#999") ?>; color:<?= h($colors[$lead["estado"]] ?? "#999") ?>;">
                <?= h($lead["estado"]) ?>
              </span>
              <?php if (!empty($comm["unread"])): ?>
                <span class="badge" title="UNSEEN desde este contacto">!</span>
              <?php endif; ?>
            </div>
          </form>
        </div>

        <div class="card" style="box-shadow:none;border-top:0;padding:14px;border:1px solid var(--border);">
          <h3 style="margin:0 0 10px;color:var(--primary);"><?= h(t("message")) ?></h3>
          <div class="notice"><?= nl2br(h($lead["mensaje"] ?? "")) ?></div>
          <div style="height:10px;"></div>
          <div class="notice">
            Consentimiento: <?= (int)$lead["consentimiento"] === 1 ? "✅" : "❌" ?>
          </div>
        </div>
      </div>

      <div style="height:14px;"></div>

      <div style="display:grid; grid-template-columns:1fr 1fr; gap:14px;">
        <div class="card" style="box-shadow:none;border-top:0;padding:14px;border:1px solid var(--border);">
          <h3 style="margin:0 0 10px;color:var(--primary);"><?= h(t("send_email")) ?></h3>

          <?php if (!mail_enabled()): ?>
            <div class="notice">Email deshabilitado en config.php</div>
          <?php else: ?>
            <form method="post">
              <input type="hidden" name="csrf" value="<?= h(csrf_token()) ?>">
              <input type="hidden" name="action" value="send_email">

              <label><?= h(t("subject")) ?></label>
              <input type="text" name="subject">

              <div style="height:10px;"></div>

              <label><?= h(t("body")) ?></label>
              <textarea name="body"></textarea>

              <div class="actions">
                <button class="btn" type="submit"><?= h(t("send")) ?></button>
              </div>
            </form>

            <div style="height:10px;"></div>
            <h4 style="margin:0 0 8px;">Log interno (mail_log)</h4>
            <div class="notice" style="max-height:260px; overflow:auto;">
              <?php if (empty($mailLog)): ?>
                <div style="color:#777;">Sin envíos registrados.</div>
              <?php else: ?>
                <?php foreach ($mailLog as $ml): ?>
                  <div style="padding:8px 0;border-bottom:1px solid #eee;">
                    <strong><?= h($ml["subject"]) ?></strong>
                    <div style="font-size:.85em;color:#666;">
                      <?= h($ml["created_at"]) ?> · <?= $ml["sent_ok"] ? "✅ OK" : "❌ ERROR" ?>
                    </div>
                    <?php if (!$ml["sent_ok"] && $ml["error_msg"]): ?>
                      <div style="font-size:.85em;color:#b30000;"><?= h($ml["error_msg"]) ?></div>
                    <?php endif; ?>
                  </div>
                <?php endforeach; ?>
              <?php endif; ?>
            </div>
          <?php endif; ?>
        </div>

        <div class="card" style="box-shadow:none;border-top:0;padding:14px;border:1px solid var(--border);">
          <h3 style="margin:0 0 10px;color:var(--primary);"><?= h(t("email_center")) ?></h3>

          <?php if (!mail_enabled()): ?>
            <div class="notice">Email deshabilitado en config.php</div>
          <?php else: ?>
            <?php if (!empty($comm["error"])): ?>
              <div class="notice" style="border-color:#ffb3b3;background:#ffe6e6;color:#b30000;">
                IMAP error: <?= h($comm["error"]) ?>
              </div>
            <?php else: ?>
              <div class="notice" style="max-height:320px; overflow:auto;">
                <strong>Sent (<?= count($comm["sent"]) ?>)</strong>
                <?php foreach ($comm["sent"] as $m): ?>
                  <div style="padding:8px 0;border-bottom:1px solid #eee;">
                    <div style="color:#333;"><strong><?= h($m["subject"]) ?></strong></div>
                    <div style="font-size:.85em;color:#666;"><?= h($m["date"]) ?></div>
                    <div style="font-size:.85em;color:#555;"><?= nl2br(h($m["snippet"])) ?></div>
                  </div>
                <?php endforeach; ?>

                <div style="height:10px;"></div>

                <strong>Received (<?= count($comm["received"]) ?>)</strong>
                <?php foreach ($comm["received"] as $m): ?>
                  <div style="padding:8px 0;border-bottom:1px solid #eee;">
                    <div style="color:#333;"><strong><?= h($m["subject"]) ?></strong></div>
                    <div style="font-size:.85em;color:#666;"><?= h($m["date"]) ?></div>
                    <div style="font-size:.85em;color:#555;"><?= nl2br(h($m["snippet"])) ?></div>
                  </div>
                <?php endforeach; ?>
              </div>
            <?php endif; ?>
          <?php endif; ?>
        </div>
      </div>

    </div>
  </main>
</div>

</body>
</html>
```


admin.php:

Gestiona el acceso al panel de administración mediante inicio de sesión.


```
<?php
require __DIR__ . "/../006-funciones.php";
require __DIR__ . "/../i18n.php";

set_lang_from_request();


ensure_admin_bootstrap();

if (is_logged()) {
  header("Location: panel.php?lang=" . urlencode(lang()));
  exit;
}

$error = "";
if ($_SERVER["REQUEST_METHOD"] === "POST") {
  csrf_check();
  $u = trim($_POST["usuario"] ?? "");
  $p = $_POST["password"] ?? "";
  if (login_attempt($u, $p, $error)) {
    header("Location: panel.php?lang=" . urlencode(lang()));
    exit;
  }
}

$cfg = cfg();
?>
<!doctype html>
<html lang="<?= h(lang()) ?>">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title><?= h($cfg["app"]["name"]) ?> - <?= h(t("admin_access")) ?></title>
  <link rel="stylesheet" href="assets/style.css">
</head>
<body>

<div class="topbar">
  <div><strong><?= h($cfg["app"]["name"]) ?></strong></div>
  <div class="langswitch">
    <a href="?lang=es">ES</a>
    <a href="?lang=en">EN</a>
  </div>
</div>

<div class="container">
  <div class="card" style="max-width:480px;margin:auto;">
    <h1><?= h(t("admin_access")) ?></h1>

    <?php if ($error !== ""): ?>
      <div class="notice"><?= h($error) ?></div>
    <?php endif; ?>

    <form method="post" class="form" style="grid-template-columns:1fr;">
      <input type="hidden" name="csrf" value="<?= h(csrf_token()) ?>">

      <div>
        <label><?= h(t("username")) ?></label>
        <input type="text" name="usuario" autocomplete="username" required>
      </div>

      <div>
        <label><?= h(t("password")) ?></label>
        <input type="password" name="password" autocomplete="current-password" required>
      </div>

      <div class="actions">
        <button class="btn" type="submit"><?= h(t("login")) ?></button>
        <a class="btn secondary" href="public/index.php?lang=<?= h(lang()) ?>"><?= h(t("public_title")) ?></a>
      </div>
    </form>

    <p style="margin-top:14px;color:#777;font-size:.9em;">
      Dominio: <?= h($cfg["app"]["domain"]) ?>
    </p>
  </div>
</div>

</body>
</html>
```


gracias.php:

Muestra un mensaje de confirmación cuando el formulario se ha enviado correctamente.


```
<?php
require __DIR__ . "/../006-funciones.php";
require __DIR__ . "/../i18n.php";
set_lang_from_request();
$cfg = cfg();
?>
<!doctype html>
<html lang="<?= h(lang()) ?>">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title><?= h($cfg["app"]["name"]) ?> - <?= h(t("thanks_title")) ?></title>
  <link rel="stylesheet" href="assets/style.css">
</head>
<body>

<div class="topbar">
  <div><strong><?= h($cfg["app"]["name"]) ?></strong></div>
  <div class="langswitch">
    <a href="?lang=es">ES</a>
    <a href="?lang=en">EN</a>
  </div>
</div>

<div class="container">
  <div class="card">
    <h1><?= h(t("thanks_title")) ?></h1>
    <p><?= h(t("thanks_text")) ?></p>

    <div class="actions">
      <a class="btn" href="index.php?lang=<?= h(lang()) ?>"><?= h(t("new_lead")) ?></a>
      <a class="btn secondary" href="../admin.php?lang=<?= h(lang()) ?>"><?= h(t("admin_access")) ?></a>
    </div>
  </div>
</div>

</body>
</html>
```


index.php:

Es la página principal pública donde los usuarios pueden solicitar un presupuesto mediante un formulario.


```
<?php
require __DIR__ . "/../006-funciones.php";
require __DIR__ . "/../i18n.php";

set_lang_from_request();

$cfg = cfg();
$appName = $cfg["app"]["name"];

$mensaje = "";

if ($_SERVER["REQUEST_METHOD"] === "POST") {
  csrf_check();

  $newId = null;
  $ok = lead_create($_POST, $mensaje, $newId);

  if ($ok && $newId) {
    $lead = lead_get($newId);
    if ($lead) {
      // emails automáticos (si mail enabled)
      send_auto_emails_new_lead($lead);
    }
    header("Location: gracias.php?lang=" . urlencode(lang()));
    exit;
  }
}
?>
<!doctype html>
<html lang="<?= h(lang()) ?>">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title><?= h($appName) ?> - <?= h(t("public_title")) ?></title>
  <link rel="stylesheet" href="assets/style.css">
</head>
<body>

<div class="topbar">
  <div><strong><?= h($appName) ?></strong></div>
  <div class="langswitch">
    <a href="?lang=es">ES</a>
    <a href="?lang=en">EN</a>
  </div>
</div>

<div class="container">
  <div class="card">
    <h1><?= h(t("public_title")) ?></h1>
    <p><?= h(t("public_subtitle")) ?></p>

    <?php if ($mensaje !== ""): ?>
      <div class="notice"><?= h($mensaje) ?></div>
    <?php endif; ?>

    <form method="post" class="form">
      <input type="hidden" name="csrf" value="<?= h(csrf_token()) ?>">

      <div>
        <label><?= h(t("name")) ?></label>
        <input type="text" name="nombre" required>
      </div>

      <div>
        <label><?= h(t("email")) ?></label>
        <input type="email" name="email" required>
      </div>

      <div>
        <label><?= h(t("phone")) ?></label>
        <input type="text" name="telefono" required>
      </div>

      <div>
        <label><?= h(t("service")) ?></label>
        <select name="servicio" required>
          <?php foreach (servicios() as $s): ?>
            <option value="<?= h($s) ?>"><?= h($s) ?></option>
          <?php endforeach; ?>
        </select>
      </div>

      <div>
        <label><?= h(t("budget")) ?></label>
        <input type="number" name="presupuesto" step="0.01" min="0" placeholder="€" required>
      </div>

      <div>
        <label><?= h(t("deadline")) ?></label>
        <input type="date" name="deadline" required>
      </div>

      <div class="full">
        <label><?= h(t("source")) ?></label>
        <select name="origen" required>
          <?php foreach (origenes() as $o): ?>
            <option value="<?= h($o) ?>"><?= h($o) ?></option>
          <?php endforeach; ?>
        </select>
      </div>

      <div class="full">
        <label><?= h(t("message")) ?></label>
        <textarea name="mensaje" required></textarea>
      </div>

      <div class="full">
        <label>
          <input type="checkbox" name="consentimiento" value="1" required>
          <?= h(t("privacy")) ?>
        </label>
      </div>

      <div class="full actions">
        <button class="btn" type="submit"><?= h(t("send")) ?></button>
        <a class="btn secondary" href="../admin.php?lang=<?= h(lang()) ?>"><?= h(t("admin_access")) ?></a>
      </div>
    </form>

    <p style="margin-top:14px;color:#777;font-size:.9em;">
      <?= h($cfg["app"]["domain"]) ?>
    </p>
  </div>
</div>

</body>
</html>
```


logout.php:

Cierra la sesión del administrador de forma segura.

c
```
<?php
require __DIR__ . "/../006-funciones.php";
logout();
header("Location: admin.php");
exit;
```

panel.php:

Es el panel privado del CRM donde se gestionan los leads, se ven los estados y se accede a los informes.


```
<?php
require __DIR__ . "/../006-funciones.php";
require __DIR__ . "/../i18n.php";

set_lang_from_request();
require_login();

$cfg = cfg();
$estados = array_keys(estados_crm());

$page = max(1, (int)($_GET["page"] ?? 1));
$perPage = 20;

$filters = [
  "q" => trim($_GET["q"] ?? ""),
  "estado" => $_GET["estado"] ?? "ALL",
];

$total = 0;
$rows = leads_list($filters, $page, $perPage, $total);
$pages = max(1, (int)ceil($total / $perPage));
?>
<!doctype html>
<html lang="<?= h(lang()) ?>">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title><?= h($cfg["app"]["name"]) ?> - <?= h(t("leads")) ?></title>
 <link rel="stylesheet" href="assets/style.css">
</head>
<body>

<div class="layout">
  <nav class="sidebar">
    <div class="brand">
      <?= h($cfg["app"]["name"]) ?><br>
      <small><?= h($cfg["app"]["owner"]) ?></small>
    </div>

    <a href="panel.php?lang=<?= h(lang()) ?>"><?= h(t("leads")) ?></a>
    <a href="public/index.php?lang=<?= h(lang()) ?>"><?= h(t("new_lead")) ?></a>
    <a href="logout.php"><?= h(t("logout")) ?></a>

    <div class="langswitch" style="margin-top:auto;">
      <a href="?lang=es">ES</a>
      <a href="?lang=en">EN</a>
    </div>
  </nav>

  <main class="main">
    <div class="tablecard">
      <h1><?= h(t("leads")) ?></h1>

      <form class="filters" method="get">
        <input type="hidden" name="lang" value="<?= h(lang()) ?>">
        <input type="text" name="q" value="<?= h($filters["q"]) ?>" placeholder="<?= h(t("search")) ?>...">
        <select name="estado">
          <option value="ALL"><?= h(t("all")) ?></option>
          <?php foreach ($estados as $e): ?>
            <option value="<?= h($e) ?>" <?= ($filters["estado"]===$e ? "selected" : "") ?>><?= h($e) ?></option>
          <?php endforeach; ?>
        </select>
        <button class="btn" type="submit"><?= h(t("search")) ?></button>
        <a class="btn secondary" href="panel.php?lang=<?= h(lang()) ?>"><?= h(t("reset")) ?></a>
      </form>

      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th><?= h(t("name")) ?></th>
            <th><?= h(t("email")) ?></th>
            <th><?= h(t("service")) ?></th>
            <th><?= h(t("status")) ?></th>
            <th><?= h(t("next_followup")) ?></th>
            <th><?= h(t("unread")) ?></th>
            <th><?= h(t("actions")) ?></th>
          </tr>
        </thead>
        <tbody>
          <?php foreach ($rows as $r): ?>
            <?php
              $colors = estados_crm();
              $color = $colors[$r["estado"]] ?? "#999";
              $unread = false;
              if (mail_enabled()) {
                $rep = crm_fetch_emails_for_contact($r["email"], 1);
                $unread = !empty($rep["unread"]);
              }
            ?>
            <tr>
              <td><?= (int)$r["id"] ?></td>
              <td><?= h($r["nombre"]) ?></td>
              <td><?= h($r["email"]) ?></td>
              <td><?= h($r["servicio"]) ?></td>
              <td>
                <span class="pill" style="border-color:<?= h($color) ?>; color:<?= h($color) ?>; background:<?= h($color) ?>20;">
                  <?= h($r["estado"]) ?>
                </span>
              </td>
              <td><?= h($r["proximo_seguimiento"] ?: "—") ?></td>
              <td>
                <?php if ($unread): ?>
                  <span class="badge" title="Emails UNSEEN desde este contacto">!</span>
                <?php else: ?>
                  <span style="color:#aaa;">—</span>
                <?php endif; ?>
              </td>
              <td>
                <a class="btn secondary" href="lead.php?id=<?= (int)$r["id"] ?>&lang=<?= h(lang()) ?>"><?= h(t("view")) ?></a>
              </td>
            </tr>
          <?php endforeach; ?>

          <?php if (empty($rows)): ?>
            <tr><td colspan="8" style="color:#777;">No hay resultados.</td></tr>
          <?php endif; ?>
        </tbody>
      </table>

      <div class="notice" style="margin-top:12px; display:flex; justify-content:space-between; align-items:center;">
        <div>Total: <?= (int)$total ?></div>
        <div>
          <?php if ($page > 1): ?>
            <a href="?lang=<?= h(lang()) ?>&q=<?= urlencode($filters["q"]) ?>&estado=<?= urlencode($filters["estado"]) ?>&page=<?= $page-1 ?>">&larr; Prev</a>
          <?php endif; ?>
          <span style="margin:0 10px;">Page <?= $page ?> / <?= $pages ?></span>
          <?php if ($page < $pages): ?>
            <a href="?lang=<?= h(lang()) ?>&q=<?= urlencode($filters["q"]) ?>&estado=<?= urlencode($filters["estado"]) ?>&page=<?= $page+1 ?>">Next &rarr;</a>
          <?php endif; ?>
        </div>
      </div>

    </div>
  </main>
</div>

</body>
</html>
```


style.css:
```
:root{
 
  --primary: #e88bb5;        
  --primary-2: #f6c1d9;      
  
  --bg: #fdf6f9;             
  --card: #ffffff;
  --text: #2f2a2d;
  --muted: #7a6b72;
  --border: #f0dce6;

  --shadow: 0 10px 30px rgba(232,139,181,.18);
  --radius: 16px;
}

*{ box-sizing:border-box; }
html,body{ height:100%; margin:0; font-family:"Segoe UI",sans-serif; color:var(--text); background:var(--bg); }

a{ color:var(--primary); text-decoration:none; }
a:hover{ text-decoration:underline; }

.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 18px;
  background:#fff;
  border-bottom:1px solid var(--border);
}

.langswitch a{
  display:inline-block;
  padding:6px 10px;
  border:1px solid var(--border);
  border-radius:999px;
  margin-left:6px;
  font-size:.85em;
  background:#fff;
}

.container{
  max-width: 980px;
  margin: 24px auto;
  padding: 0 18px;
}

.card{
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  border-top:8px solid var(--primary);
  padding:22px 24px;
}

h1{ margin:0 0 6px; color:var(--primary); }
p{ margin:8px 0; color:#555; }

.form{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:14px;
  margin-top:16px;
}
.form .full{ grid-column: 1 / -1; }

label{ font-size:.9em; font-weight:700; color:var(--primary); display:block; margin-bottom:6px; }
input,select,textarea{
  width:100%;
  padding:11px 12px;
  border:1px solid var(--border);
  border-radius:8px;
  font-size:1em;
}
textarea{ min-height:120px; resize:vertical; }

.actions{ margin-top:14px; display:flex; gap:10px; align-items:center; }
.btn{
  background:var(--primary);
  color:#fff;
  border:none;
  padding:12px 14px;
  border-radius:8px;
  cursor:pointer;
  font-size:1em;
}
.btn.secondary{
  background:#fff;
  color:var(--primary);
  border:1px solid var(--primary-light);
}

.notice{
  padding:10px 12px;
  border:1px solid var(--border);
  background:#fafafa;
  border-radius:10px;
  font-size:.9em;
}


.layout{
  display:flex;
  min-height:100vh;
}

nav.sidebar{
  width:240px;
  background:var(--primary);
  padding:18px;
  display:flex;
  flex-direction:column;
  gap:10px;
  color:#fff;
}

nav.sidebar .brand{
  font-weight:800;
  line-height:1.2;
}

nav.sidebar a{
  color:#fff;
  background:rgba(255,255,255,0.12);
  padding:10px 12px;
  border-radius:999px;
  display:block;
}
nav.sidebar a:hover{ background:rgba(255,255,255,0.20); text-decoration:none; }

main.main{
  flex:1;
  padding:24px;
}

.tablecard{
  background:#fff;
  border-radius:12px;
  box-shadow:var(--shadow);
  border-top:8px solid var(--primary);
  padding:16px 18px;
}

table{ width:100%; border-collapse:collapse; font-size:.92em; }
th,td{ padding:10px 8px; border-bottom:1px solid var(--border); text-align:left; }
thead th{ color:var(--primary); border-bottom:2px solid var(--primary-light); }

.pill{
  display:inline-block;
  padding:4px 10px;
  border-radius:999px;
  border:1px solid var(--border);
  font-size:.82em;
  background:#f9f9f9;
}

.badge{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  min-width:22px;
  height:22px;
  border-radius:999px;
  background:#2ecc71;
  color:white;
  font-size:.75em;
  font-weight:800;
}
.badge::before{ content:"✉"; margin-right:4px; }

.filters{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin: 12px 0 14px;
}
.filters input, .filters select{ width:auto; min-width: 220px; }

@media (max-width: 860px){
  .form{ grid-template-columns:1fr; }
  nav.sidebar{ width:100%; flex-direction:row; flex-wrap:wrap; }
  .layout{ flex-direction:column; }
}
```


A partir del proyecto que hicimos en clase, he ido mejorándolo poco a poco:

- Primero, he adaptado el proyecto para que sea un CRM personal, pensado para mi trabajo como freelance en desarrollo web.
- He cambiado el formulario, personalizándolo con mis datos y con un diseño más bonito, usando colores pastel.
- He creado una base de datos propia y he hecho que los datos del formulario se guarden correctamente.
- Después, he hecho un panel de administración, donde puedo ver todas las solicitudes que llegan.
- He añadido un inicio de sesión, para que solo yo pueda acceder al panel.
-También he añadido estados para cada contacto, para saber si es un cliente nuevo, si está en seguimiento o si ya está cerrado.
- He añadido la opción de ver un informe de cada contacto y poder enviar correos desde el panel.
- Por último, he añadido la posibilidad de usar dos idiomas (español e inglés) y he adaptado todo el proyecto a un caso real que podría usar en el futuro.


Gracias a este proyecto he podido entender mejor cómo funciona una aplicación web completa. He aprendido a guardar datos en una base de datos, a crear un panel de administración y a organizar mejor el código. Además, he adaptado el proyecto a algo que podría usar en el futuro como freelance, lo que me ha ayudado a ver una aplicación real de lo aprendido en clase.
