<!doctype html>
<html lang="es">
  <head>
    <title>Calendario</title>
    <style>
      #jvcalendario .mes{display:grid;width:1400px;grid-template-columns:repeat(7,100fr);}
      #jvcalendario .mes .dia{border:1px solid lightgray;height:250px;padding:10px;font-size:10px;display:flex;flex-direction:column;justify-content:space-between;}
      #jvcalendario .mes .dia .hora{border-bottom:1px solid lightgray;display:flex;gap:20px;}
      #jvcalendario .mes .desactivado{background:lightgrey;}
      #jvcalendario .mes .dia .hora:nth-child(even){background:rgb(240,240,240);}
      #jvcalendario .mes .dia .hora .evento{background:red;color:white;padding:5px;border-radius:5px;width:80%;}
    </style>
  </head>
  <body>
    <button id="guardar">Guardar</button>
    <div id="jvcalendario"></div>

    <script>
      function diasEnMes(year, month) {
        return new Date(year, month, 0).getDate();
      }
      function primerDiaDelMes(year, month) {
        return new Date(year, month - 1, 1).getDay();
      }

      
      let boton = document.querySelector("#guardar");
      boton.onclick = function(){
        let eventos = document.querySelectorAll(".evento");
        let json = [];

        eventos.forEach(function(ev){
          const texto = ev.textContent.trim();
          if (texto === "") return; 

          json.push({
            anio: Number(ev.getAttribute("anio")),
            mes:  Number(ev.getAttribute("mes")),
            dia:  Number(ev.getAttribute("dia")),
            hora: Number(ev.getAttribute("hora")),
            texto: texto
          });
        });

        localStorage.setItem("jvcalendario_simple", JSON.stringify(json));
        console.log("Guardado OK:", json);
      };

      let contenedor = document.querySelector("#jvcalendario");
      let anio = 2026;
      let meses = 12;
      let nombres_meses = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio',
      'Agosto','Septiembre','Octubre','Noviembre','Diciembre'];

      for(let i = 1; i <= meses; i++){
        let dias_en_mes = diasEnMes(anio, i);

        let titulo = document.createElement("h3");
        titulo.textContent = nombres_meses[i-1];
        contenedor.appendChild(titulo);

        let mes = document.createElement("div");
        mes.classList.add("mes");
        mes.setAttribute("mes", nombres_meses[i-1]);

        let inicio_mes = primerDiaDelMes(anio, i) + 6;

        for(let j = 1; j <= inicio_mes; j++){
          let dia = document.createElement("div");
          dia.classList.add("dia");
          dia.classList.add("desactivado");
          mes.appendChild(dia);
        }

        for(let j = 1; j <= dias_en_mes; j++){
          let dia = document.createElement("div");
          dia.classList.add("dia");
          dia.textContent = j;

          for(let k = 8; k <= 21; k++){
            let hora = document.createElement("div");
            hora.classList.add("hora");
            hora.textContent = k;

            hora.onclick = function(){
             
              const existente = hora.querySelector(".evento");
              if (existente) {
                existente.focus();
                return;
              }

              let evento = document.createElement("div");
              evento.classList.add("evento");

              
              evento.setAttribute("anio", anio);
              evento.setAttribute("mes", i);
              evento.setAttribute("dia", j);
              evento.setAttribute("hora", k);

              evento.setAttribute("contenteditable", true);
              hora.appendChild(evento);
              evento.focus();
            };

            dia.appendChild(hora);
          }

          mes.appendChild(dia);
        }

        contenedor.appendChild(mes);
      }
    </script>
  </body>
</html>

